databaseChangeLog:
  - changeSet:
      id: add-slug-to-category-006
      author: you
      changes:
        # 1) slug sütununu ekle (önce nullable)
        - addColumn:
            tableName: category
            columns:
              - column:
                  name: slug
                  type: VARCHAR(255)

        # 2) Mevcut kayıtlar için slug üret
        - sql:
            sql: |
              UPDATE category
              SET slug = lower(regexp_replace(name, '[^a-zA-Z0-9]+', '-', 'g'));
              UPDATE category
              SET slug = trim(both '-' from slug);

        # 3) NOT NULL yap
        - addNotNullConstraint:
            tableName: category
            columnName: slug
            columnDataType: VARCHAR(255)

        # 4) UNIQUE constraint ekle
        - addUniqueConstraint:
            tableName: category
            columnNames: slug
            constraintName: uk_category_slug
